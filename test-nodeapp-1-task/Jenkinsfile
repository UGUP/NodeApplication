pipeline {
    agent any
    stages {
        stage('Clone') {
            steps {
                sshagent(['git-cred']) {
                    git branch: 'main',
                    credentialsId: 'git',
                    url: 'git@github.com:UGUP/NodeApplication.git'
                }
            }
        }
       stage('Change directory') {
           steps {
            dir("test-nodeapp-1-task") {
                sh "pwd"
            }  
        }
      }
       stage('Install Sudo') {
            steps {
                sh 'apt-get update && apt-get install sudo -y'
            }
        }

        stage('Install Docker') {
            steps {
                sh 'sudo apt-get update && sudo apt-get install docker.io -y'
            }
        }

      stage('Build a Docker Image'){
        steps {
            sh "docker build -t node-application:$BUILD_NUMBER .";
        }
      }

    
    // stage('Build and Push Docker Image') {
    //   steps {
    //     script {
    //       def app = docker.build("-t test-nodeapp-1-task:${env.BUILD_NUMBER} test-nodeapp-1-task")
          
    //       sh 'aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 017706783036.dkr.ecr.us-east-1.amazonaws.com'
    //       app.tag("017706783036.dkr.ecr.us-east-1.amazonaws.com/node-application:${env.BUILD_NUMBER}")
    //       app.push("017706783036.dkr.ecr.us-east-1.amazonaws.com/node-application:${env.BUILD_NUMBER}")
    //     }
    //   }
    // }
       }
    }



